from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys

options = Options()
#options.add_argument("--headless=new")
options.add_experimental_option("detach", True)

driver = webdriver.Chrome(options=options)
driver.get("http://target.lab/")
driver.set_window_size(1920, 1080)

sqli_polyglots_file = open("./sqli_polyglots.txt")
sqli_polyglots = sqli_polyglots_file.readlines()
sqli_polyglots = [polyglot.strip() for polyglot in sqli_polyglots]

forms = driver.find_elements(By.XPATH, "//form")
html = driver.find_element(By.XPATH, "//html")

for form in forms:
    print(f"[+] Found form {form.get_attribute('id')}:")
    inputs = form.find_elements(By.XPATH, ".//input")
    button = form.find_element(By.XPATH, ".//button")
    for form_input in inputs:
        print(f"\t - Input: {form_input.get_attribute('name')}")
        for payload in sqli_polyglots:
            form_input.send_keys(payload)
            button.click()
            if "SQL Error" in html.get_attribute("innerHTML"):
                print(f"\t\t- Vulnerability: SQL Injection!!!")
                print(f"\t\t\t- Payload: {payload}")